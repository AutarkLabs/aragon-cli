{"version":3,"sources":["../../../../src/commands/dao_cmds/token_cmds/change-controller.js"],"names":["TaskList","require","ensureWeb3","getContract","listrOpts","chalk","getRecommendedGasLimit","exports","command","describe","builder","yargs","positional","description","task","web3","gasPrice","tokenAddress","newController","silent","debug","eth","getAccounts","accounts","from","title","ctx","artifact","contract","Contract","abi","tx","methods","changeController","estimateGas","gas","sendPromise","send","on","transactionHash","txHash","error","output","handler","reporter","network","run","then","success","green","info","blue","process","exit"],"mappings":"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","sourcesContent":["const TaskList = require('listr')\nconst { ensureWeb3 } = require('../../../helpers/web3-fallback')\nconst { getContract } = require('../../../util')\nconst listrOpts = require('@aragon/cli-utils/src/helpers/listr-options')\nconst chalk = require('chalk')\nconst { getRecommendedGasLimit } = require('../../../util')\n\nexports.command = 'change-controller <token-address> <new-controller>'\n\nexports.describe = 'Change the controller of a MiniMe token'\n\nexports.builder = yargs => {\n  return yargs\n    .positional('token-address', {\n      description: 'Address of the MiniMe token',\n    })\n    .positional('new-controller', {\n      description: 'Address of the new controller',\n    })\n}\n\nexports.task = async ({\n  web3,\n  gasPrice,\n  tokenAddress,\n  newController,\n  silent,\n  debug,\n}) => {\n  // Decode sender\n  const accounts = await web3.eth.getAccounts()\n  const from = accounts[0]\n\n  return new TaskList(\n    [\n      {\n        title: 'Changing the MiniMe token controller',\n        task: async (ctx, task) => {\n          let artifact = getContract(\n            '@aragon/apps-shared-minime',\n            'MiniMeToken'\n          )\n          let contract = new web3.eth.Contract(artifact.abi, tokenAddress)\n\n          const tx = contract.methods.changeController(newController)\n          // this fails if from is not passed\n          const gas = await getRecommendedGasLimit(\n            web3,\n            await tx.estimateGas({ from })\n          )\n\n          const sendPromise = tx.send({ from, gas, gasPrice })\n          sendPromise\n            .on('transactionHash', transactionHash => {\n              ctx.txHash = transactionHash\n            })\n            .on('error', function(error) {\n              throw error\n            })\n\n          task.output = `Waiting for the transaction to be mined...`\n          return sendPromise\n        },\n      },\n    ],\n    listrOpts(silent, debug)\n  )\n}\n\nexports.handler = async function({\n  reporter,\n  gasPrice,\n  network,\n  tokenAddress,\n  newController,\n  silent,\n  debug,\n}) {\n  const web3 = await ensureWeb3(network)\n\n  const task = await exports.task({\n    web3,\n    gasPrice,\n    reporter,\n    tokenAddress,\n    newController,\n    silent,\n    debug,\n  })\n  return task.run().then(ctx => {\n    reporter.success(\n      `Successfully changed the controller of ${chalk.green(\n        tokenAddress\n      )} to ${chalk.green(newController)}`\n    )\n    reporter.info(`Transaction hash: ${chalk.blue(ctx.txHash)}`)\n\n    process.exit()\n  })\n}\n"],"file":"change-controller.js"}