{"version":3,"sources":["../../../../src/commands/dao_cmds/utils/aragonjs-wrapper.js"],"names":["noop","subscribe","wrapper","onApps","onForwarders","onTransaction","onPermissions","apps","forwarders","transactions","permissions","subscriptions","connectedApp","resolveEnsDomain","domain","opts","message","initWrapper","dao","ensRegistryAddress","provider","gasPrice","accounts","walletProvider","ipfsConf","onError","onDaoAddress","isDomain","test","registryAddress","daoAddress","Error","Aragon","defaultGasPriceFn","apm","ipfs","init","providedAccounts","cancel","Object","values","forEach","subscription","unsubscribe"],"mappings":"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","sourcesContent":["import Aragon, { ensResolve } from '@aragon/wrapper'\n\nconst noop = () => {}\n\n// Subscribe to wrapper's observables\nconst subscribe = (\n  wrapper,\n  { onApps, onForwarders, onTransaction, onPermissions }\n) => {\n  const { apps, forwarders, transactions, permissions } = wrapper\n\n  const subscriptions = {\n    apps: apps.subscribe(onApps),\n    connectedApp: null,\n    forwarders: forwarders.subscribe(onForwarders),\n    transactions: transactions.subscribe(onTransaction),\n    permissions: permissions.subscribe(onPermissions),\n  }\n\n  return subscriptions\n}\n\nexport async function resolveEnsDomain(domain, opts) {\n  try {\n    return await ensResolve(domain, opts)\n  } catch (err) {\n    if (err.message === 'ENS name not defined.') {\n      return ''\n    }\n    throw err\n  }\n}\n\nconst initWrapper = async (\n  dao,\n  ensRegistryAddress,\n  {\n    provider,\n    gasPrice,\n    accounts = '',\n    walletProvider = null,\n    ipfsConf = {},\n    onError = noop,\n    onApps = noop,\n    onForwarders = noop,\n    onTransaction = noop,\n    onDaoAddress = noop,\n    onPermissions = noop,\n  } = {}\n) => {\n  const isDomain = dao => /[a-z0-9]+\\.eth/.test(dao)\n\n  const daoAddress = isDomain(dao)\n    ? await resolveEnsDomain(dao, {\n        provider,\n        registryAddress: ensRegistryAddress,\n      })\n    : dao\n\n  if (!daoAddress) {\n    onError(new Error('The provided DAO address is invalid'))\n    return\n  }\n\n  onDaoAddress(daoAddress)\n\n  // TODO: don't reinitialize if cached\n\n  const wrapper = new Aragon(daoAddress, {\n    provider,\n    defaultGasPriceFn: () => gasPrice,\n    apm: {\n      ipfs: ipfsConf,\n      ensRegistryAddress,\n    },\n  })\n\n  try {\n    await wrapper.init({ accounts: { providedAccounts: accounts } })\n  } catch (err) {\n    if (err.message === 'connection not open') {\n      onError(\n        new Error('The wrapper can not be initialized without a connection')\n      )\n      return\n    }\n    throw err\n  }\n\n  const subscriptions = subscribe(\n    wrapper,\n    { onApps, onForwarders, onTransaction, onPermissions },\n    { ipfsConf }\n  )\n\n  wrapper.cancel = () => {\n    Object.values(subscriptions).forEach(subscription => {\n      if (subscription) {\n        subscription.unsubscribe()\n      }\n    })\n  }\n\n  return wrapper\n}\n\nexport default initWrapper\n"],"file":"aragonjs-wrapper.js"}