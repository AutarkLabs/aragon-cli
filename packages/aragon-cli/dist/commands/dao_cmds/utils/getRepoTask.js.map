{"version":3,"sources":["../../../../src/commands/dao_cmds/utils/getRepoTask.js"],"names":["pkg","require","LATEST_VERSION","DEFAULT_IPFS_TIMEOUT","aragon","defaultIpfsTimeout","module","exports","args","yargs","option","describe","task","apm","apmRepo","apmRepoVersion","artifactRequired","ctx","getLatestVersion","repo","getVersion","split","appId","Error"],"mappings":";;;;;;;;;;;;;;;;AAAA,IAAMA,GAAG,GAAGC,OAAO,CAAC,0BAAD,CAAnB;;AACA,IAAMC,cAAc,GAAG,QAAvB;AACA,IAAMC,oBAAoB,GAAGH,GAAG,CAACI,MAAJ,CAAWC,kBAAxC;AAEAC,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,IAAI,EAAE,cAAAC,KAAK,EAAI;AACb,WAAOA,KAAK,CACTC,MADI,CACG,SADH,EACc;AACjBC,MAAAA,QAAQ,EAAE;AADO,KADd,EAIJD,MAJI,CAIG,gBAJH,EAIqB;AACxBC,MAAAA,QAAQ,EAAE,qCADc;AAExB,iBAAS;AAFe,KAJrB,CAAP;AAQD,GAVc;AAWfC,EAAAA,IAAI,EAAE,oBAKA;AAAA,QAJJC,GAII,QAJJA,GAII;AAAA,QAHJC,OAGI,QAHJA,OAGI;AAAA,mCAFJC,cAEI;AAAA,QAFJA,cAEI,oCAFab,cAEb;AAAA,qCADJc,gBACI;AAAA,QADJA,gBACI,sCADe,IACf;AACJ;AAAA;AAAA;AAAA;AAAA;AAAA,gCAAO,iBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA,wBACDF,cAAc,KAAKb,cADlB;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAEcW,GAAG,CAACK,gBAAJ,CAAqBJ,OAArB,EAA8BX,oBAA9B,CAFd;;AAAA;AAEHc,kBAAAA,GAAG,CAACE,IAFD;AAAA;AAAA;;AAAA;AAAA;AAAA,yBAIcN,GAAG,CAACO,UAAJ,CACfN,OADe,EAEfC,cAAc,CAACM,KAAf,CAAqB,GAArB,CAFe,EAGflB,oBAHe,CAJd;;AAAA;AAIHc,kBAAAA,GAAG,CAACE,IAJD;;AAAA;AAAA,wBAYDH,gBAAgB,IAAI,CAACC,GAAG,CAACE,IAAJ,CAASG,KAZ7B;AAAA;AAAA;AAAA;;AAAA,wBAeG,IAAIC,KAAJ,CACJ,yHADI,CAfH;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBD;AArCc,CAAjB","sourcesContent":["const pkg = require('../../../../package.json')\nconst LATEST_VERSION = 'latest'\nconst DEFAULT_IPFS_TIMEOUT = pkg.aragon.defaultIpfsTimeout\n\nmodule.exports = {\n  args: yargs => {\n    return yargs\n      .option('apmRepo', {\n        describe: 'Name of the aragonPM repo',\n      })\n      .option('apmRepoVersion', {\n        describe: 'Version of the package upgrading to',\n        default: 'latest',\n      })\n  },\n  task: ({\n    apm,\n    apmRepo,\n    apmRepoVersion = LATEST_VERSION,\n    artifactRequired = true,\n  }) => {\n    return async ctx => {\n      if (apmRepoVersion === LATEST_VERSION) {\n        ctx.repo = await apm.getLatestVersion(apmRepo, DEFAULT_IPFS_TIMEOUT)\n      } else {\n        ctx.repo = await apm.getVersion(\n          apmRepo,\n          apmRepoVersion.split('.'),\n          DEFAULT_IPFS_TIMEOUT\n        )\n      }\n\n      // appId is loaded from artifact.json in IPFS\n      if (artifactRequired && !ctx.repo.appId) {\n        // TODO: load ipfs aragon node and fetch repo again. If this time we have the artifact then return otherwise throw Error.\n\n        throw new Error(\n          'Cannot find artifacts in aragonPM repo. Please make sure the package is published and IPFS or your HTTP server running.'\n        )\n      }\n    }\n  },\n}\n"],"file":"getRepoTask.js"}