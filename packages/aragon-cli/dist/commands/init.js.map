{"version":3,"sources":["../../src/commands/init.js"],"names":["require","promisify","clone","TaskList","installDeps","isValidAragonId","defaultAPMName","listrOpts","exports","command","describe","builder","yargs","positional","description","option","process","cwd","coerce","resolveTemplateName","tmpl","aliases","bare","react","includes","Error","handler","reporter","name","template","silent","debug","basename","split","tasks","title","task","ctx","output","error","shallow","run","then","success","warning"],"mappings":"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","sourcesContent":["import { checkProjectExists, prepareTemplate } from '../lib/init'\nconst { promisify } = require('util')\nconst clone = promisify(require('git-clone'))\nconst TaskList = require('listr')\nconst { installDeps, isValidAragonId } = require('../util')\nconst defaultAPMName = require('@aragon/cli-utils/src/helpers/default-apm')\nconst listrOpts = require('@aragon/cli-utils/src/helpers/listr-options')\n\nexports.command = 'init <name> [template]'\n\nexports.describe =\n  '(deprecated) Initialise a new application. Deprecated in favor of `npx create-aragon-app <name> [template]`'\n\nexports.builder = yargs => {\n  return yargs\n    .positional('name', {\n      description: 'The application name (appname.aragonpm.eth)',\n    })\n    .option('cwd', {\n      description: 'The current working directory',\n      default: process.cwd(),\n    })\n    .positional('template', {\n      description: 'The template to scaffold from',\n      default: 'react',\n      coerce: function resolveTemplateName(tmpl) {\n        const aliases = {\n          bare: 'aragon/aragon-bare-boilerplate',\n          react: 'aragon/aragon-react-boilerplate',\n        }\n\n        if (!tmpl.includes('/')) {\n          if (tmpl === 'react-kit') {\n            throw new Error(\n              `Template 'react-kit' was merged with 'react' template.`\n            )\n          } else if (!aliases[tmpl]) {\n            throw new Error(`No template named ${tmpl} exists`)\n          }\n          tmpl = aliases[tmpl]\n        }\n\n        return `https://github.com/${tmpl}`\n      },\n    })\n}\n\nexports.handler = function({ reporter, name, template, silent, debug }) {\n  name = defaultAPMName(name)\n  const basename = name.split('.')[0]\n\n  const tasks = new TaskList(\n    [\n      {\n        title: 'Preparing initialization',\n        task: async (ctx, task) => {\n          task.output = 'Checking if project folder already exists...'\n          if (!isValidAragonId(basename)) {\n            throw new Error(\n              reporter.error(\n                'Invalid project name. Please only use lowercase alphanumeric and hyphen characters.'\n              )\n            )\n          }\n\n          await checkProjectExists(basename)\n        },\n      },\n      {\n        title: 'Cloning app template',\n        task: async (ctx, task) => {\n          task.output = `Cloning ${template} into ${basename}...`\n          await clone(template, basename, { shallow: true })\n        },\n      },\n      {\n        title: 'Preparing template',\n        task: async (ctx, task) => {\n          task.output = 'Initiliazing arapp.json and removing Git repository'\n          await prepareTemplate(basename, name)\n        },\n      },\n      {\n        title: 'Installing package dependencies',\n        task: async (ctx, task) => installDeps(basename, task),\n      },\n    ],\n    listrOpts(silent, debug)\n  )\n\n  return tasks.run().then(() => {\n    reporter.success(`Created new application ${name} in ${basename}.`)\n    reporter.warning(\n      `Use of \\`aragon init\\` is deprecated and has been replaced with \\`npx create-aragon-app\\`.`\n    )\n  })\n}\n"],"file":"init.js"}