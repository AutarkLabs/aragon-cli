{"version":3,"sources":["../../../src/commands/ipfs_cmds/view.js"],"names":["startIPFS","require","exports","command","describe","builder","yargs","positional","description","task","apmOptions","silent","debug","cid","TaskList","title","ctx","ipfs","rpc","client","recursive","merkleDAG","handler","reporter","apm","run","console","log"],"mappings":";;;;;;;;AAAA;;AAEA;;AAKA;;;;;;;;AAEA,IAAMA,SAAS,GAAGC,OAAO,CAAC,SAAD,CAAzB;;AAEAC,OAAO,CAACC,OAAR,GAAkB,YAAlB;AACAD,OAAO,CAACE,QAAR,GACE,+DADF;;AAGAF,OAAO,CAACG,OAAR,GAAkB,UAAAC,KAAK,EAAI;AACzB;AACA,SAAOA,KAAK,CAACC,UAAN,CAAiB,KAAjB,EAAwB;AAC7BC,IAAAA,WAAW,EAAE;AADgB,GAAxB,CAAP;AAGD,CALD;;AAOAN,OAAO,CAACO,IAAR,GAAe,gBAAwC;AAAA,MAArCC,UAAqC,QAArCA,UAAqC;AAAA,MAAzBC,MAAyB,QAAzBA,MAAyB;AAAA,MAAjBC,KAAiB,QAAjBA,KAAiB;AAAA,MAAVC,GAAU,QAAVA,GAAU;AACrD,SAAO,IAAIC,iBAAJ,CACL,CACE;AACA;AACEC,IAAAA,KAAK,EAAE,YADT;AAEEN,IAAAA,IAAI,EAAE;AAAA,aAAMT,SAAS,CAACS,IAAV,CAAe;AAAEC,QAAAA,UAAU,EAAVA;AAAF,OAAf,CAAN;AAAA;AAFR,GAFF,EAME;AACEK,IAAAA,KAAK,EAAE,iBADT;AAEEN,IAAAA,IAAI;AAAA;AAAA;AAAA,8BAAE,iBAAMO,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACa,4BAAiBN,UAAU,CAACO,IAAX,CAAgBC,GAAjC,CADb;;AAAA;AACJF,gBAAAA,GAAG,CAACC,IADA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAFN,GANF,EAYE;AACEF,IAAAA,KAAK,EAAE,iBADT;AAEEN,IAAAA,IAAI;AAAA;AAAA;AAAA,8BAAE,kBAAMO,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACkB,wBAAaA,GAAG,CAACC,IAAJ,CAASE,MAAtB,EAA8BN,GAA9B,EAAmC;AACvDO,kBAAAA,SAAS,EAAE;AAD4C,iBAAnC,CADlB;;AAAA;AACJJ,gBAAAA,GAAG,CAACK,SADA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAFN,GAZF,CADK,EAsBL,8BAAUV,MAAV,EAAkBC,KAAlB,CAtBK,CAAP;AAwBD,CAzBD;;AA2BAV,OAAO,CAACoB,OAAR;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAChBC,YAAAA,QADgB,SAChBA,QADgB,EAEXb,UAFW,SAEhBc,GAFgB,EAGhBX,GAHgB,SAGhBA,GAHgB,EAIhBD,KAJgB,SAIhBA,KAJgB,EAKhBD,MALgB,SAKhBA,MALgB;AAAA;AAAA,mBAOGT,OAAO,CAACO,IAAR,CAAa;AAC9Bc,cAAAA,QAAQ,EAARA,QAD8B;AAE9Bb,cAAAA,UAAU,EAAVA,UAF8B;AAG9BG,cAAAA,GAAG,EAAHA,GAH8B;AAI9BD,cAAAA,KAAK,EAALA,KAJ8B;AAK9BD,cAAAA,MAAM,EAANA;AAL8B,aAAb,CAPH;;AAAA;AAOVF,YAAAA,IAPU;AAAA;AAAA,mBAeEA,IAAI,CAACgB,GAAL,EAfF;;AAAA;AAeVT,YAAAA,GAfU;AAgBhBU,YAAAA,OAAO,CAACC,GAAR,CAAY,8BAAmBX,GAAG,CAACK,SAAvB,CAAZ;;AAhBgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAlB;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import TaskList from 'listr'\n//\nimport {\n  ensureConnection,\n  getMerkleDAG,\n  stringifyMerkleDAG,\n} from '../../lib/ipfs'\nimport listrOpts from '@aragon/cli-utils/src/helpers/listr-options'\n\nconst startIPFS = require('./start')\n\nexports.command = 'view <cid>'\nexports.describe =\n  'Display metadata about the content, such as size, links, etc.'\n\nexports.builder = yargs => {\n  // TODO add support for \"ipfs paths\", e.g: QmP49YSJVhQTySqLDFTzFZPG8atf3CLsQSPDVj3iATQkhC/arapp.json\n  return yargs.positional('cid', {\n    description: 'A self-describing content-addressed identifier',\n  })\n}\n\nexports.task = ({ apmOptions, silent, debug, cid }) => {\n  return new TaskList(\n    [\n      // TODO validation of the CID\n      {\n        title: 'Check IPFS',\n        task: () => startIPFS.task({ apmOptions }),\n      },\n      {\n        title: 'Connect to IPFS',\n        task: async ctx => {\n          ctx.ipfs = await ensureConnection(apmOptions.ipfs.rpc)\n        },\n      },\n      {\n        title: 'Fetch the links',\n        task: async ctx => {\n          ctx.merkleDAG = await getMerkleDAG(ctx.ipfs.client, cid, {\n            recursive: true,\n          })\n        },\n      },\n    ],\n    listrOpts(silent, debug)\n  )\n}\n\nexports.handler = async function({\n  reporter,\n  apm: apmOptions,\n  cid,\n  debug,\n  silent,\n}) {\n  const task = await exports.task({\n    reporter,\n    apmOptions,\n    cid,\n    debug,\n    silent,\n  })\n\n  const ctx = await task.run()\n  console.log(stringifyMerkleDAG(ctx.merkleDAG))\n}\n"],"file":"view.js"}